# Koishi QQ 问答机器人

## 项目说明

这是为 GitHub 技术日报系统添加的智能问答机器人，基于 Koishi 框架开发。

## 功能特性

- @机器人触发对话
- 智能问答：回答项目相关问题
- 多源知识库：代码 + 文档 + Notion
- GLM 大模型驱动
- 对话历史记录

## 目录结构

```
koishi-bot/
├── koishi.yml              # Koishi 主配置
├── package.json            # 项目依赖
├── plugins/                # 插件目录
│   └── qa-bot/            # 问答插件
│       ├── index.ts        # 插件入口
│       ├── knowledge.ts    # 知识库管理
│       ├── glm-client.ts   # GLM API 客户端
│       └── prompts.ts      # Prompt 构建器
├── data/                   # 数据目录
└── logs/                   # 日志目录
```

## 快速开始

### 1. 安装依赖

\`\`\`bash
npm install
\`\`\`

### 2. 配置 NapCat

确保 NapCat 已启用 WebSocket：

\`\`\`json
{
  "ws": {
    "enable": true,
    "host": "0.0.0.0",
    "port": 3001
  }
}
\`\`\`

### 3. 启动机器人

\`\`\`bash
npm run dev
\`\`\`

### 4. 在 QQ 群中使用

直接 @机器人 + 你的问题

## 环境变量

主要配置已在 \`koishi.yml\` 中设置，GLM API Key 和 Notion Token 从项目根目录的 \`.env\` 文件读取。

## 常用命令

- \`qa.help\` - 显示帮助信息
- \`qa.reload\` - 重新加载知识库

## 开发说明

### 插件原理

Koishi 的核心架构：

\`\`\`
┌─────────────────────────────────────────────────────────┐
│                      Koishi 框架                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌─────────────────────────────────────────────────┐   │
│  │                   Adapter 层                      │   │
│  │  连接各种聊天平台 (QQ, Telegram, Discord...)    │   │
│  └─────────────────────────────────────────────────┘   │
│                          │                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │                   Middleware 层                  │   │
│  │  消息处理中间件链                                │   │
│  └─────────────────────────────────────────────────┘   │
│                          │                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │                   Plugin 层                      │   │
│  │  自定义插件 (问答机器人)                         │   │
│  └─────────────────────────────────────────────────┘   │
│                                                          │
└─────────────────────────────────────────────────────────┘
\`\`\`

### 消息流程

\`\`\`
用户消息 → Adapter → Middleware → Plugin → 处理 → 回复
                                              ↓
                                          知识库检索
                                              ↓
                                          GLM API 调用
\`\`\`
