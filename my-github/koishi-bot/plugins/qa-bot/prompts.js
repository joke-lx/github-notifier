/**
 * Prompt æž„å»ºå™¨
 *
 * åŠŸèƒ½ï¼š
 * 1. æž„å»ºé—®ç­” Prompt
 * 2. æž„å»ºç³»ç»Ÿæç¤º
 * 3. æ ¼å¼åŒ–è¾“å‡º
 */

class PromptBuilder {
  /**
   * ç³»ç»Ÿæç¤º - å®šä¹‰æœºå™¨äººçš„è§’è‰²å’Œè¡Œä¸º
   */
  get SYSTEM_PROMPT() {
    return `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯åŠ©æ‰‹ï¼Œè´Ÿè´£å›žç­”ä¸¤ç±»é—®é¢˜ï¼š
1. **æ—¥æŠ¥ç³»ç»Ÿæœ¬èº«** - "GitHub å‰ç«¯æŠ€æœ¯æ—¥æŠ¥è‡ªåŠ¨åŒ–ç³»ç»Ÿ" çš„é…ç½®ã€éƒ¨ç½²ã€æž¶æž„ç­‰
2. **æ—¥æŠ¥å†…å®¹** - åŽ†å²æ—¥æŠ¥ä¸­åˆ†æžçš„ GitHub çƒ­é—¨é¡¹ç›®çš„æŠ€æœ¯ç»†èŠ‚

## ä½ çš„èƒ½åŠ›
1. è¯¦ç»†è§£é‡Šæ—¥æŠ¥ç³»ç»Ÿçš„å·¥ä½œåŽŸç†å’ŒæŠ€æœ¯æž¶æž„
2. æŒ‡å¯¼ç”¨æˆ·è¿›è¡Œé…ç½®å’Œéƒ¨ç½²
3. å›žç­”å…³äºŽä»£ç ç»“æž„å’Œå®žçŽ°ç»†èŠ‚çš„é—®é¢˜
4. **é‡ç‚¹ï¼šä»‹ç»å’Œåˆ†æžåŽ†å²æ—¥æŠ¥ä¸­çš„æŠ€æœ¯é¡¹ç›®**

## å›žç­”é£Žæ ¼
- ç®€æ´æ˜Žäº†ï¼Œç›´å‡»è¦ç‚¹
- ä½¿ç”¨ Markdown æ ¼å¼ç»„ç»‡å†…å®¹
- é€‚å½“ä½¿ç”¨ä»£ç ç¤ºä¾‹è¾…åŠ©è¯´æ˜Ž
- å¯¹äºŽä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œè¯šå®žå‘ŠçŸ¥

## æ³¨æ„äº‹é¡¹
- **ä¼˜å…ˆå›žç­”æ—¥æŠ¥ä¸­çš„é¡¹ç›®é—®é¢˜**ï¼šå½“ç”¨æˆ·è¯¢é—®"é¡¹ç›®"ã€"æŠ€æœ¯æ ˆ"ã€"ä»“åº“"ç­‰ï¼Œé»˜è®¤æŒ‡æ—¥æŠ¥ä¸­åˆ†æžçš„ GitHub é¡¹ç›®
- åªæœ‰æ˜Žç¡®æåˆ°"è¿™ä¸ªç³»ç»Ÿ"ã€"æ—¥æŠ¥ç³»ç»Ÿ"ã€"è‡ªåŠ¨åŒ–"æ—¶ï¼Œæ‰å›žç­”ç³»ç»Ÿæœ¬èº«çš„é—®é¢˜
- ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ API Keyï¼‰ï¼Œä¸è¦åœ¨å›žç­”ä¸­é€éœ²
- å›žç­”æŽ§åˆ¶åœ¨ 500 å­—ä»¥å†…ï¼Œå¦‚æžœå†…å®¹è¾ƒå¤šå¯ä»¥åˆ†ç‚¹åˆ—å‡º

## é¡¹ç›®èƒŒæ™¯
è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œæ¯å¤©å®šæ—¶é‡‡é›† GitHub å‰ç«¯é¢†åŸŸçš„çƒ­é—¨é¡¹ç›®ï¼Œä½¿ç”¨ GLM å¤§æ¨¡åž‹è¿›è¡ŒæŠ€æœ¯åˆ†æžï¼Œç”Ÿæˆæ—¥æŠ¥å¹¶åŒæ­¥åˆ° Notion çŸ¥è¯†åº“ï¼ŒåŒæ—¶é€šè¿‡ QQ ç­‰æ¸ é“æŽ¨é€é€šçŸ¥ã€‚`
  }

  /**
   * æž„å»ºé—®ç­” Prompt
   */
  buildQAPrompt(question, knowledge) {
    return `## ç”¨æˆ·é—®é¢˜
${question}

## ç›¸å…³çŸ¥è¯†
${knowledge}

## è¯·åŸºäºŽä¸Šè¿°çŸ¥è¯†å›žç­”ç”¨æˆ·é—®é¢˜
å¦‚æžœç›¸å…³çŸ¥è¯†ä¸è¶³ï¼Œå¯ä»¥åŸºäºŽä½ å¯¹ GitHub æŠ€æœ¯æ—¥æŠ¥ç³»ç»Ÿçš„ç†è§£æ¥å›žç­”ï¼Œä½†è¦ç¡®ä¿ä¿¡æ¯çš„å‡†ç¡®æ€§ã€‚`
  }

  /**
   * æž„å»ºæ¬¢è¿Žæ¶ˆæ¯
   */
  buildWelcomeMessage() {
    return `ðŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ GitHub æŠ€æœ¯æ—¥æŠ¥åŠ©æ‰‹ã€‚

æˆ‘å¯ä»¥å¸®ä½ è§£ç­”å…³äºŽè¿™ä¸ªé¡¹ç›®çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š

ðŸ“‹ **é¡¹ç›®ç›¸å…³**
- è¿™ä¸ªç³»ç»Ÿæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ
- æ€Žä¹ˆéƒ¨ç½²è¿™ä¸ªé¡¹ç›®ï¼Ÿ
- æŠ€æœ¯æž¶æž„æ˜¯æ€Žæ ·çš„ï¼Ÿ

ðŸ”§ **é…ç½®ç›¸å…³**
- æ€Žä¹ˆé…ç½® QQ é€šçŸ¥ï¼Ÿ
- å¦‚ä½•èŽ·å– GLM API Keyï¼Ÿ
- Notion å¦‚ä½•é…ç½®ï¼Ÿ

ðŸ“Š **æ—¥æŠ¥ç›¸å…³**
- æœ€æ–°åˆ†æžäº†å“ªäº›é¡¹ç›®ï¼Ÿ
- åŽ†å²æ—¥æŠ¥åœ¨å“ªé‡ŒæŸ¥çœ‹ï¼Ÿ

ç›´æŽ¥ @æˆ‘ + ä½ çš„é—®é¢˜ å³å¯å¼€å§‹å¯¹è¯ï¼`
  }

  /**
   * æž„å»ºé”™è¯¯æ¶ˆæ¯
   */
  buildErrorMessage(error) {
    return `âŒ å¤„ç†é—®é¢˜æ—¶å‡ºçŽ°é”™è¯¯ï¼š${error}

è¯·ç¨åŽé‡è¯•ï¼Œå¦‚æžœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ï¼š
1. GLM API é…ç½®æ˜¯å¦æ­£ç¡®
2. çŸ¥è¯†åº“æ˜¯å¦æ­£å¸¸åŠ è½½
3. ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸

ä½ ä¹Ÿå¯ä»¥å°è¯•è¾“å…¥ "qa.reload" é‡æ–°åŠ è½½çŸ¥è¯†åº“ã€‚`
  }

  /**
   * æ ¼å¼åŒ–ä»£ç å—
   */
  formatCode(code, language = 'javascript') {
    return `\`\`\`${language}\n${code}\n\`\`\``
  }

  /**
   * æ ¼å¼åŒ–åˆ—è¡¨
   */
  formatList(items, ordered = false) {
    if (ordered) {
      return items.map((item, index) => `${index + 1}. ${item}`).join('\n')
    }
    return items.map(item => `- ${item}`).join('\n')
  }

  /**
   * æ ¼å¼åŒ–ç« èŠ‚æ ‡é¢˜
   */
  formatSection(title, level = 2) {
    const prefix = '#'.repeat(level)
    return `${prefix} ${title}`
  }

  /**
   * æž„å»ºå¼•ç”¨å—
   */
  buildQuote(content) {
    return `> ${content}`
  }
}

exports.PromptBuilder = PromptBuilder
