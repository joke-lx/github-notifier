/**
 * Prompt æ„å»ºå™¨
 *
 * åŠŸèƒ½ï¼š
 * 1. æ„å»ºé—®ç­” Prompt
 * 2. æ„å»ºç³»ç»Ÿæç¤º
 * 3. æ ¼å¼åŒ–è¾“å‡º
 */

export class PromptBuilder {
  /**
   * ç³»ç»Ÿæç¤º - å®šä¹‰æœºå™¨äººçš„è§’è‰²å’Œè¡Œä¸º
   */
  private readonly SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯åŠ©æ‰‹ï¼Œè´Ÿè´£å›ç­”å…³äº "GitHub å‰ç«¯æŠ€æœ¯æ—¥æŠ¥è‡ªåŠ¨åŒ–ç³»ç»Ÿ" çš„é—®é¢˜ã€‚

## ä½ çš„èƒ½åŠ›
1. è¯¦ç»†è§£é‡Šé¡¹ç›®çš„å·¥ä½œåŸç†å’ŒæŠ€æœ¯æ¶æ„
2. æŒ‡å¯¼ç”¨æˆ·è¿›è¡Œé…ç½®å’Œéƒ¨ç½²
3. å›ç­”å…³äºä»£ç ç»“æ„å’Œå®ç°ç»†èŠ‚çš„é—®é¢˜
4. ä»‹ç»å†å²æ—¥æŠ¥ä¸­çš„æŠ€æœ¯å†…å®¹

## å›ç­”é£æ ¼
- ç®€æ´æ˜äº†ï¼Œç›´å‡»è¦ç‚¹
- ä½¿ç”¨ Markdown æ ¼å¼ç»„ç»‡å†…å®¹
- é€‚å½“ä½¿ç”¨ä»£ç ç¤ºä¾‹è¾…åŠ©è¯´æ˜
- å¯¹äºä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œè¯šå®å‘ŠçŸ¥

## æ³¨æ„äº‹é¡¹
- åªå›ç­”ä¸è¯¥é¡¹ç›®ç›¸å…³çš„é—®é¢˜
- å¦‚æœç”¨æˆ·é—®çš„é—®é¢˜è¶…å‡ºèŒƒå›´ï¼Œç¤¼è²Œåœ°å¼•å¯¼å›é¡¹ç›®ä¸»é¢˜
- ä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ API Keyï¼‰ï¼Œä¸è¦åœ¨å›ç­”ä¸­é€éœ²
- å›ç­”æ§åˆ¶åœ¨ 500 å­—ä»¥å†…ï¼Œå¦‚æœå†…å®¹è¾ƒå¤šå¯ä»¥åˆ†ç‚¹åˆ—å‡º

## é¡¹ç›®èƒŒæ™¯
è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–ç³»ç»Ÿï¼Œæ¯å¤©å®šæ—¶é‡‡é›† GitHub å‰ç«¯é¢†åŸŸçš„çƒ­é—¨é¡¹ç›®ï¼Œä½¿ç”¨ GLM å¤§æ¨¡å‹è¿›è¡ŒæŠ€æœ¯åˆ†æï¼Œç”Ÿæˆæ—¥æŠ¥å¹¶åŒæ­¥åˆ° Notion çŸ¥è¯†åº“ï¼ŒåŒæ—¶é€šè¿‡ QQ ç­‰æ¸ é“æ¨é€é€šçŸ¥ã€‚`

  /**
   * æ„å»ºé—®ç­” Prompt
   */
  buildQAPrompt(question: string, knowledge: string): string {
    return `## ç”¨æˆ·é—®é¢˜
${question}

## ç›¸å…³çŸ¥è¯†
${knowledge}

## è¯·åŸºäºä¸Šè¿°çŸ¥è¯†å›ç­”ç”¨æˆ·é—®é¢˜
å¦‚æœç›¸å…³çŸ¥è¯†ä¸è¶³ï¼Œå¯ä»¥åŸºäºä½ å¯¹ GitHub æŠ€æœ¯æ—¥æŠ¥ç³»ç»Ÿçš„ç†è§£æ¥å›ç­”ï¼Œä½†è¦ç¡®ä¿ä¿¡æ¯çš„å‡†ç¡®æ€§ã€‚`
  }

  /**
   * æ„å»ºæ¬¢è¿æ¶ˆæ¯
   */
  buildWelcomeMessage(): string {
    return `ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ GitHub æŠ€æœ¯æ—¥æŠ¥åŠ©æ‰‹ã€‚

æˆ‘å¯ä»¥å¸®ä½ è§£ç­”å…³äºè¿™ä¸ªé¡¹ç›®çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š

ğŸ“‹ **é¡¹ç›®ç›¸å…³**
- è¿™ä¸ªç³»ç»Ÿæ˜¯åšä»€ä¹ˆçš„ï¼Ÿ
- æ€ä¹ˆéƒ¨ç½²è¿™ä¸ªé¡¹ç›®ï¼Ÿ
- æŠ€æœ¯æ¶æ„æ˜¯æ€æ ·çš„ï¼Ÿ

ğŸ”§ **é…ç½®ç›¸å…³**
- æ€ä¹ˆé…ç½® QQ é€šçŸ¥ï¼Ÿ
- å¦‚ä½•è·å– GLM API Keyï¼Ÿ
- Notion å¦‚ä½•é…ç½®ï¼Ÿ

ğŸ“Š **æ—¥æŠ¥ç›¸å…³**
- æœ€æ–°åˆ†æäº†å“ªäº›é¡¹ç›®ï¼Ÿ
- å†å²æ—¥æŠ¥åœ¨å“ªé‡ŒæŸ¥çœ‹ï¼Ÿ

ç›´æ¥ @æˆ‘ + ä½ çš„é—®é¢˜ å³å¯å¼€å§‹å¯¹è¯ï¼`
  }

  /**
   * æ„å»ºé”™è¯¯æ¶ˆæ¯
   */
  buildErrorMessage(error: string): string {
    return `âŒ å¤„ç†é—®é¢˜æ—¶å‡ºç°é”™è¯¯ï¼š${error}

è¯·ç¨åé‡è¯•ï¼Œå¦‚æœé—®é¢˜æŒç»­ï¼Œè¯·æ£€æŸ¥ï¼š
1. GLM API é…ç½®æ˜¯å¦æ­£ç¡®
2. çŸ¥è¯†åº“æ˜¯å¦æ­£å¸¸åŠ è½½
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

ä½ ä¹Ÿå¯ä»¥å°è¯•è¾“å…¥ "qa.reload" é‡æ–°åŠ è½½çŸ¥è¯†åº“ã€‚`
  }

  /**
   * æ ¼å¼åŒ–ä»£ç å—
   */
  formatCode(code: string, language: string = 'javascript'): string {
    return `\`\`\`${language}\n${code}\n\`\`\``
  }

  /**
   * æ ¼å¼åŒ–åˆ—è¡¨
   */
  formatList(items: string[], ordered: boolean = false): string {
    if (ordered) {
      return items.map((item, index) => `${index + 1}. ${item}`).join('\n')
    }
    return items.map(item => `- ${item}`).join('\n')
  }

  /**
   * æ ¼å¼åŒ–ç« èŠ‚æ ‡é¢˜
   */
  formatSection(title: string, level: number = 2): string {
    const prefix = '#'.repeat(level)
    return `${prefix} ${title}`
  }

  /**
   * æ„å»ºå¼•ç”¨å—
   */
  buildQuote(content: string): string {
    return `> ${content}`
  }
}
